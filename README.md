# Nightscout Ottai CGM Uploader

–°–∫—Ä–∏–ø—Ç –Ω–∞ Python –¥–ª—è –ø–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–æ–π –æ—Ç–ø—Ä–∞–≤–∫–∏ –¥–∞–Ω–Ω—ã—Ö –æ –≥–ª—é–∫–æ–∑–µ –æ—Ç —Ñ–æ–ª–ª–æ–≤–µ—Ä–∞ Ottai –≤ Nightscout.

> –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–æ –Ω–∞ —Ä–æ—Å—Å–∏–π—Å–∫–∏—Ö –¥–∞—Ç—á–∏–∫–∞—Ö Ottai –≤ –±–µ–ª–æ–π –∫–æ—Ä–æ–±–∫–µ.

## ‚ö†Ô∏è –í–∞–∂–Ω–æ–µ –∏–∑–º–µ–Ω–µ–Ω–∏–µ

–ò–∑–º–µ–Ω—ë–Ω —Ñ–æ—Ä–º–∞—Ç –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è. –ü—Ä–∏ –∑–∞–ø—É—Å–∫–µ –ø—Ä–æ–≥—Ä–∞–º–º–∞ –≤—ã–≤–æ–¥–∏—Ç —Å–ø–∏—Å–æ–∫ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –º–∞—Å—Ç–µ—Ä–æ–≤ –¥–ª—è —Ñ–æ–ª–ª–æ–≤–µ—Ä–∞. –î–ª—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –º–∞—Å—Ç–µ—Ä–∞ –ø—Ä–µ—Ñ–∏–∫—Å –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π —Å—Ç—Ä–æ–∏—Ç—Å—è –Ω–∞ –æ—Å–Ω–æ–≤–∞–Ω–∏–∏ –∞–¥—Ä–µ—Å–∞ –ø–æ—á—Ç—ã –¥–æ –∑–Ω–∞–∫–∞ `@`.  
–ù–∞–ø—Ä–∏–º–µ—Ä, –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è `test@example.com` –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –±—É–¥—É—Ç –≤–∏–¥–∞:

- `NS_URL__test`
- `NS_SECRET__test`

## ‚öôÔ∏è –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

–°–∫—Ä–∏–ø—Ç –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Å–ª–µ–¥—É—é—â–∏–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è:

| –ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è | –û–ø–∏—Å–∞–Ω–∏–µ | –ü—Ä–∏–º–µ—Ä | –û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ |
|------------|----------|--------|-------------|
| **OTTAI_TOKEN** | Ottai API JWT —Ç–æ–∫–µ–Ω | `eyJhbGciOiJIUzUxMiJ9.eyJleHAiOjE3NDQyODUzMzcsInVzZXJJZCI6IjIwMTEyMzQ1In0.qGMRGHFi7EKhDvsYQ2wfc1mL_efuFDqjcG1_wE_e5NQbuK1zx7CCvtEQHlIUKrq54pPL0AQ-rn_bB0t5Yzx1xg` | –î–∞ |
| **NS_URL** | URL –∞–¥—Ä–µ—Å Nightscout | `https://j12345678.nightscout-jino.ru` | –î–∞ |
| **NS_SECRET** | API Secret NightScout | `H4uSur24Bkwu` | –î–∞ |
| **HOURS_AGO** | –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ –ø–µ—Ä–µ–≤—ã–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö –ø—Ä–∏ –ø–æ—Ç–µ—Ä–µ —Å–≤—è–∑–∏ (–≤ —á–∞—Å–∞—Ö) | `5` | –î–∞ |
| **OTTAI_BASE_URL** | –°–µ—Ä–≤–µ—Ä –¥–ª—è –≤—ã–≥—Ä—É–∑–∫–∏. –î–ª—è Syai —É–∫–∞–∂–∏—Ç–µ `https://ru.syai.com`. –î–ª—è Ottai –æ—Å—Ç–∞–≤—å—Ç–µ –ø—É—Å—Ç—ã–º. | `https://ru.syai.com` | –ù–µ—Ç |
| **OTTAI_CUSTOMER_ID** | ID —Ñ–æ–ª–ª–æ–≤–µ—Ä–∞ (–º–æ–∂–Ω–æ —É–≤–∏–¥–µ—Ç—å –≤ –¥–∞–º–ø–µ –æ–±–º–µ–Ω–∞ —Å —Å–µ—Ä–≤–µ—Ä–æ–º) | `20251217` | –ù–µ—Ç |
| **DISABLE_SSL_VERIFY** | –û—Ç–∫–ª—é—á–∞–µ—Ç –ø—Ä–æ–≤–µ—Ä–∫—É —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–≤ (–∫–æ—Å—Ç—ã–ª—å –¥–ª—è —Å–ª—É—á–∞–µ–≤, –∫–æ–≥–¥–∞ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç Ottai –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–µ–Ω) | `true` | –ù–µ—Ç |

## üîë –ü–æ–ª—É—á–µ–Ω–∏–µ Ottai API JWT —Ç–æ–∫–µ–Ω–∞

### 1. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –º–∞—Å—Ç–µ—Ä–∞ –∏ —Ñ–æ–ª–ª–æ–≤–µ—Ä–∞
- –ú–∞—Å—Ç–µ—Ä –≤—ã–±–∏—Ä–∞–µ—Ç ¬´–ø–æ–¥–µ–ª–∏—Ç—å—Å—è¬ª –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ Ottai –∏ –≤–≤–æ–¥–∏—Ç –∞–¥—Ä–µ—Å –ø–æ—á—Ç—ã —Ñ–æ–ª–ª–æ–≤–µ—Ä–∞
- **–í–∞–∂–Ω–æ:** –ù–µ–ª—å–∑—è –±—ã—Ç—å –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ –º–∞—Å—Ç–µ—Ä–æ–º –∏ —Ñ–æ–ª–ª–æ–≤–µ—Ä–æ–º. –ê–¥—Ä–µ—Å–∞ –ø–æ—á—Ç –¥–æ–ª–∂–Ω—ã –æ—Ç–ª–∏—á–∞—Ç—å—Å—è!

### 2. –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π
- –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ **Ottai Share** –Ω–∞ —Ç–µ–ª–µ—Ñ–æ–Ω —Ñ–æ–ª–ª–æ–≤–µ—Ä–∞ –∏ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–π—Ç–µ—Å—å
- –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –¥–ª—è –∑–∞—Ö–≤–∞—Ç–∞ –ø–∞–∫–µ—Ç–æ–≤:
  - **PCAPdroid** –¥–ª—è Android
  - **–ó–∞—Ö–≤–∞—Ç HTTP-—Ç—Ä–∞—Ñ–∏–∫–∞** –¥–ª—è iOS
- –ù–∞—Å—Ç—Ä–æ–π—Ç–µ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç —Å–æ–≥–ª–∞—Å–Ω–æ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –¥–ª—è –∑–∞—Ö–≤–∞—Ç–∞ –ø–∞–∫–µ—Ç–æ–≤

### 3. –ü–æ–ª—É—á–µ–Ω–∏–µ —Ç–æ–∫–µ–Ω–∞
- –ó–∞–ø—É—Å—Ç–∏—Ç–µ –∑–∞—Ö–≤–∞—Ç —Ç—Ä–∞—Ñ–∏–∫–∞ –∏ –æ—Ç–∫—Ä–æ–π—Ç–µ Ottai Share
- –í –∑–∞–≥–æ–ª–æ–≤–∫–∞—Ö –∑–∞–ø—Ä–æ—Å–æ–≤ –Ω–∞–π–¥–∏—Ç–µ `authorization:"..."` ‚Äî —ç—Ç–æ –≤–∞—à `OTTAI_TOKEN`
- –¢–∞–∫–∂–µ –≤ –∑–∞–≥–æ–ª–æ–≤–∫–∞—Ö –Ω–∞–π–¥–∏—Ç–µ `customer_id` ‚Äî —ç—Ç–æ –∑–Ω–∞—á–µ–Ω–∏–µ –¥–ª—è –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π `OTTAI_CUSTOMER_ID`

> **–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ:** –¢–æ–∫–µ–Ω –≤—ã–¥–∞—ë—Ç—Å—è –Ω–∞ –ø–æ–ª–≥–æ–¥–∞ –∏ –¥–æ–ª–∂–µ–Ω –æ—Å—Ç–∞–≤–∞—Ç—å—Å—è –Ω–µ–∏–∑–º–µ–Ω–Ω—ã–º. –ü—Ä–∏ –ø–µ—Ä–µ—É—Å—Ç–∞–Ω–æ–≤–∫–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –∏–ª–∏ –ø–æ–≤—Ç–æ—Ä–Ω–æ–º –≤—Ö–æ–¥–µ/–≤—ã—Ö–æ–¥–µ –ø—Ä–æ—Ü–µ–¥—É—Ä—É –Ω—É–∂–Ω–æ –ø–æ–≤—Ç–æ—Ä–∏—Ç—å.

## üê≥ –ó–∞–ø—É—Å–∫ —Å –ø–æ–º–æ—â—å—é Docker

### –°–±–æ—Ä–∫–∞ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞
```bash
docker build -t ottai-nightscout-uploader .
```


#### –ó–∞–ø—É—Å–∫ —á–µ—Ä–µ–∑ docker compose 
1. –í–Ω–µ—Å–∏—Ç–µ –∑–Ω–∞—á–µ–Ω–∏—è –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –≤ —Ñ–∞–π–ª docker-compose.yml –≤ —Ä–∞–∑–¥–µ–ª environment

2. –ó–∞–ø—É—Å—Ç–∏—Ç–µ –∏–∑ –∫–æ—Ä–Ω—è —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è:
```
docker compose up -d
```

### üì± –ó–∞–ø—É—Å–∫ –Ω–∞ —Ç–µ–ª–µ—Ñ–æ–Ω–µ —á–µ—Ä–µ–∑ Termux (Android)

1. –°–∫–∞—á–∞–π—Ç–µ –∏ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ [termux](https://play.google.com/store/apps/details?id=com.termux) 

2. –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –ø–∞–∫–µ—Ç–æ–≤
```
pkg up -y && pkg install openssl python3 git openssl-static openssl-tool
```

3. –ö–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è
```
git clone https://github.com/pmakhotkin/ottai-nightscout-uploader.git
```

4. –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
```
cd ottai-nightscout-uploader/
pip install -r requirements.txt
```
5. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è

```
nano .env
```
–í–Ω–µ—Å–∏—Ç–µ —Å–≤–æ–∏ –¥–∞–Ω–Ω—ã–µ (—Ç–æ–∫–µ–Ω, –∞–¥—Ä–µ—Å Nightscout, API secret, –≤—Ä–µ–º—è –ø–µ—Ä–µ–∑–∞–ø—Ä–æ—Å–∞). –°–æ—Ö—Ä–∞–Ω–∏—Ç–µ —Ñ–∞–π–ª (Ctrl+O).
–°–æ—Ö—Ä–∞–Ω–∏—Ç–µ —Ñ–∞–π–ª –Ω–∞–∂–∞—Ç–∏–µ–º ctrl+O

6. –ó–∞–≥—Ä—É–∑–∫–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è

```
source .env
```

7. –ó–∞–ø—É—Å–∫ —Å–∫—Ä–∏–ø—Ç–∞

```
python -u main.py
```
### üìä –û–∂–∏–¥–∞–µ–º—ã–π –≤—ã–≤–æ–¥ –ø—Ä–∏ —É—Å–ø–µ—à–Ω–æ–π —Ä–∞–±–æ—Ç–µ
```
Nightscout POST request 200 OK                          
2024-10-17 11:04:19.483938
entries uploaded.
```
–ï—Å–ª–∏ –≤—ã–≤–æ–¥ –æ—Ç–ª–∏—á–∞–µ—Ç—Å—è, –ø—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç—å –≤–≤–µ–¥—ë–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö.

